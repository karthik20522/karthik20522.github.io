<h1 class="post-title h1" role="heading">Secure FTP User Isolation in IIS</h1>
<p>Jan 26, 2018</p>
<p>Leveraging FTP user isolation will provide an additional layer of security over the standard&nbsp;authentication and authorization. This is especially helpful for web servers that only have a single IP address and have multiple users who require FTP access. In this scenario, you&nbsp;would create&nbsp;one main FTP site with multiple virtual directories for the various users. Even if your web server has additional&nbsp;IP addresses&nbsp;for multiple FTP sites, you can still implement it. FTP User Isolation&nbsp;can be leveraged anytime&nbsp;you want to&nbsp;restrict users to specific content folders&nbsp;within a site.</p>
<p>&nbsp;</p>
<h2>Getting Started</h2>
<p>As shown in IIS Manager below, I have set up 3 websites and 1 FTP site. The root folder of the FTP site points to c:\inetpub\ftproot.</p>
<p>Click on&nbsp;<strong>FTP Authentication</strong>&nbsp;and confirm that&nbsp;<strong>Anonymous Authentication</strong>&nbsp;is disabled and&nbsp;<strong>Basic Authentication</strong>&nbsp;is enabled.</p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/IIS_Manager.png"><img class="aligncenter size-full wp-image-5603" src="http://www.sherweb.com/blog/wp-content/uploads/IIS_Manager.png" alt="IIS Manager" width="582" height="377" /></a></p>
<h2>Create Local Users and FTP Group</h2>
<p>Using the&nbsp;<strong>Computer Management Snap-In,</strong>&nbsp;I have created 3 local users that will be used for logging in to the FTP site. They are called ftpuser1, ftpuser2, and ftpuser3.</p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/Computer_Management.png"><img class="aligncenter size-full wp-image-5598" src="http://www.sherweb.com/blog/wp-content/uploads/Computer_Management.png" alt="Computer Management Snap-In" width="517" height="288" /></a></p>
<p>Next I create a local user group called&nbsp;<strong>FTPUsers</strong>&nbsp;and add the 3 user accounts. Then I add this group to the folder permissions of c:\inetpub\ftproot.</p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/FTPUsers_Properties.png"><img class="aligncenter size-full wp-image-5602" src="http://www.sherweb.com/blog/wp-content/uploads/FTPUsers_Properties.png" alt="FTPUsers Properties" width="351" height="393" /></a></p>
<h2>Configure FTP Authorization Rules</h2>
<p>In the&nbsp;<strong>Features</strong>&nbsp;view of the FTP site in IIS Manager, click on the&nbsp;<strong>FTP Authorization</strong>&nbsp;icon. In the settings, select&nbsp;<strong>Specified roles or user groups</strong>&nbsp;and&nbsp;enter the&nbsp;<strong>FTPUsers</strong>&nbsp;local group that was just created in the previous step. Storing all the FTP users in one local group will make the FTP site considerably easier to maintain in the future if new users are added. Next click the checkboxes for&nbsp;<strong>Read</strong>&nbsp;and&nbsp;<strong>Write</strong>&nbsp;permissions. Click&nbsp;<strong>OK</strong>&nbsp;to close the window.</p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/Edit_Authorization_Rule.png"><img class="aligncenter size-full wp-image-5599" src="http://www.sherweb.com/blog/wp-content/uploads/Edit_Authorization_Rule.png" alt="Edit Allow Authorization Rule" width="440" height="393" /></a></p>
<p>&nbsp;</p>
<h2>Configure the LocalUser Virtual Directory</h2>
<p>The next step is to create a virtual directory on the FTP site called&nbsp;<strong>LocalUser</strong>. This is a special directory that is needed to make user isolation work as expected. In IIS Manager, right-click on the FTP site and select&nbsp;<strong>Add Virtual Directory</strong>.</p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/IIS_Manager_2.png"><img class="aligncenter size-full wp-image-5604" src="http://www.sherweb.com/blog/wp-content/uploads/IIS_Manager_2.png" alt="Master FTP Home" width="528" height="443" /></a></p>
<p>On the&nbsp;<strong>Add Virtual Directory</strong>&nbsp;properties, enter the name&nbsp;<strong>LocalUser</strong>&nbsp;for the&nbsp;<strong>Alias. For&nbsp;</strong>the&nbsp;<strong>Physical path,</strong>&nbsp;specify the root folder of the FTP site.</p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/Add_Virtual_Directory.png"><img class="aligncenter size-full wp-image-5596" src="http://www.sherweb.com/blog/wp-content/uploads/Add_Virtual_Directory.png" alt="Add Virtual Directory" width="457" height="370" /></a></p>
<h2>Create FTP User Virtual Directories</h2>
<p>After creating the&nbsp;<strong>LocalUser</strong>&nbsp;virtual directory, we need to create an additional virtual directory under it for each FTP user that will be accessing the FTP site. On the&nbsp;<strong>Add Virtual Directory</strong>&nbsp;properties, enter the FTP user name and specify the destination path of the folder where their files are located. In the example below,&nbsp;<strong>ftpuser1</strong>&nbsp;will have access to c:\domains\domain1.com. Repeat this&nbsp;step for the other FTP users.</p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/Add_Virtual_Directory_2.png"><img class="aligncenter size-full wp-image-5597" src="http://www.sherweb.com/blog/wp-content/uploads/Add_Virtual_Directory_2.png" alt="Add Virtual Directory Physical Path" width="544" height="452" /></a></p>
<p>In the picture below we can see the FTP site has been set up with the&nbsp;<strong>LocalUser</strong>&nbsp;virtual directory and below it, the virtual directories for the 3 FTP users.</p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/IIS_Manager_3.png"><img class="aligncenter size-full wp-image-5605" src="http://www.sherweb.com/blog/wp-content/uploads/IIS_Manager_3.png" alt="LocalUser Home" width="548" height="371" /></a></p>
<h2>Configure FTP User Isolation</h2>
<p>On the&nbsp;<strong>Features</strong>&nbsp;view of the FTP site, click on&nbsp;<strong>FTP User Isolation</strong>. Under&nbsp;<strong>Isolate users,</strong>&nbsp;select&nbsp;<strong>User name directory (disable global virtual directories)</strong>&nbsp;as shown below<strong>.&nbsp;</strong>If your FTP site will only have 1 admin user you do not need to configure isolation; in that case just select the option&nbsp;<strong>FTP Root directory.</strong></p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/IIS_Manager_4.png"><img class="aligncenter size-full wp-image-5606" src="http://www.sherweb.com/blog/wp-content/uploads/IIS_Manager_4.png" alt="FTP User Isolation" width="570" height="400" /></a></p>
<h1 class="post-title h1" role="heading">Secure FTP User Isolation in IIS</h1>
<p>Jan 26, 2018</p>
<p>Leveraging FTP user isolation will provide an additional layer of security over the standard&nbsp;authentication and authorization. This is especially helpful for web servers that only have a single IP address and have multiple users who require FTP access. In this scenario, you&nbsp;would create&nbsp;one main FTP site with multiple virtual directories for the various users. Even if your web server has additional&nbsp;IP addresses&nbsp;for multiple FTP sites, you can still implement it. FTP User Isolation&nbsp;can be leveraged anytime&nbsp;you want to&nbsp;restrict users to specific content folders&nbsp;within a site.</p>
<p>&nbsp;</p>
<h2>Getting Started</h2>
<p>As shown in IIS Manager below, I have set up 3 websites and 1 FTP site. The root folder of the FTP site points to c:\inetpub\ftproot.</p>
<p>Click on&nbsp;<strong>FTP Authentication</strong>&nbsp;and confirm that&nbsp;<strong>Anonymous Authentication</strong>&nbsp;is disabled and&nbsp;<strong>Basic Authentication</strong>&nbsp;is enabled.</p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/IIS_Manager.png"><img class="aligncenter size-full wp-image-5603" src="http://www.sherweb.com/blog/wp-content/uploads/IIS_Manager.png" alt="IIS Manager" width="582" height="377" /></a></p>
<h2>Create Local Users and FTP Group</h2>
<p>Using the&nbsp;<strong>Computer Management Snap-In,</strong>&nbsp;I have created 3 local users that will be used for logging in to the FTP site. They are called ftpuser1, ftpuser2, and ftpuser3.</p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/Computer_Management.png"><img class="aligncenter size-full wp-image-5598" src="http://www.sherweb.com/blog/wp-content/uploads/Computer_Management.png" alt="Computer Management Snap-In" width="517" height="288" /></a></p>
<p>Next I create a local user group called&nbsp;<strong>FTPUsers</strong>&nbsp;and add the 3 user accounts. Then I add this group to the NTFS permissions of c:\inetpub\ftproot.</p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/FTPUsers_Properties.png"><img class="aligncenter size-full wp-image-5602" src="http://www.sherweb.com/blog/wp-content/uploads/FTPUsers_Properties.png" alt="FTPUsers Properties" width="351" height="393" /></a></p>
<h2>Configure FTP Authorization Rules</h2>
<p>In the&nbsp;<strong>Features</strong>&nbsp;view of the FTP site in IIS Manager, click on the&nbsp;<strong>FTP Authorization</strong>&nbsp;icon. In the settings, select&nbsp;<strong>Specified roles or user groups</strong>&nbsp;and&nbsp;enter the&nbsp;<strong>FTPUsers</strong>&nbsp;local group that was just created in the previous step. Storing all the FTP users in one local group will make the FTP site considerably easier to maintain in the future if new users are added. Next click the checkboxes for&nbsp;<strong>Read</strong>&nbsp;and&nbsp;<strong>Write</strong>&nbsp;permissions. Click&nbsp;<strong>OK</strong>&nbsp;to close the window.</p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/Edit_Authorization_Rule.png"><img class="aligncenter size-full wp-image-5599" src="http://www.sherweb.com/blog/wp-content/uploads/Edit_Authorization_Rule.png" alt="Edit Allow Authorization Rule" width="440" height="393" /></a></p>
<p>&nbsp;</p>
<h2>Configure the LocalUser Virtual Directory</h2>
<p>The next step is to create a virtual directory on the FTP site called&nbsp;<strong>LocalUser</strong>. This is a special directory that is needed to make user isolation work as expected. In IIS Manager, right-click on the FTP site and select&nbsp;<strong>Add Virtual Directory</strong>.</p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/IIS_Manager_2.png"><img class="aligncenter size-full wp-image-5604" src="http://www.sherweb.com/blog/wp-content/uploads/IIS_Manager_2.png" alt="Master FTP Home" width="528" height="443" /></a></p>
<p>On the&nbsp;<strong>Add Virtual Directory</strong>&nbsp;properties, enter the name&nbsp;<strong>LocalUser</strong>&nbsp;for the&nbsp;<strong>Alias. For&nbsp;</strong>the&nbsp;<strong>Physical path,</strong>&nbsp;specify the root folder of the FTP site.</p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/Add_Virtual_Directory.png"><img class="aligncenter size-full wp-image-5596" src="http://www.sherweb.com/blog/wp-content/uploads/Add_Virtual_Directory.png" alt="Add Virtual Directory" width="457" height="370" /></a></p>
<h2>Create FTP User Virtual Directories</h2>
<p>After creating the&nbsp;<strong>LocalUser</strong>&nbsp;virtual directory, we need to create an additional virtual directory under it for each FTP user that will be accessing the FTP site. On the&nbsp;<strong>Add Virtual Directory</strong>&nbsp;properties, enter the FTP user name and specify the destination path of the folder where their files are located. In the example below,&nbsp;<strong>ftpuser1</strong>&nbsp;will have access to c:\domains\domain1.com. Repeat this&nbsp;step for the other FTP users.</p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/Add_Virtual_Directory_2.png"><img class="aligncenter size-full wp-image-5597" src="http://www.sherweb.com/blog/wp-content/uploads/Add_Virtual_Directory_2.png" alt="Add Virtual Directory Physical Path" width="544" height="452" /></a></p>
<p>In the picture below we can see the FTP site has been set up with the&nbsp;<strong>LocalUser</strong>&nbsp;virtual directory and below it, the virtual directories for the 3 FTP users.</p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/IIS_Manager_3.png"><img class="aligncenter size-full wp-image-5605" src="http://www.sherweb.com/blog/wp-content/uploads/IIS_Manager_3.png" alt="LocalUser Home" width="548" height="371" /></a></p>
<h2>Configure FTP User Isolation</h2>
<p>On the&nbsp;<strong>Features</strong>&nbsp;view of the FTP site, click on&nbsp;<strong>FTP User Isolation</strong>. Under&nbsp;<strong>Isolate users,</strong>&nbsp;select&nbsp;<strong>User name directory (disable global virtual directories)</strong>&nbsp;as shown below<strong>.&nbsp;</strong>If your FTP site will only have 1 admin user you do not need to configure isolation; in that case just select the option&nbsp;<strong>FTP Root directory.</strong></p>
<p><a href="http://www.sherweb.com/blog/wp-content/uploads/IIS_Manager_4.png"><img class="aligncenter size-full wp-image-5606" src="http://www.sherweb.com/blog/wp-content/uploads/IIS_Manager_4.png" alt="FTP User Isolation" width="570" height="400" /></a></p>
<p>Done!</p>