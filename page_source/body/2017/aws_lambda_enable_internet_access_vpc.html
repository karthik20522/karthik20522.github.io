<h1 class="ef b eg en co">Enable Outgoing Internet Access within VPC: AWS Lambda</h1>
<p>Jan 6, 2017</p>
<h3>VPC</h3>
<p>Your VPC should have a CIDR Block that looks something like: 192.168.0.0/16, you will need to know this number.</p>
<h3>Internet Gateway</h3>
<p>For your VPC to have access to the internet it requires an Internet Gateway. You can create one of these by going to&nbsp;<strong>Networking and Content Delivery</strong>&nbsp;&gt;&nbsp;<strong>VPC</strong>&nbsp;&gt;&nbsp;<strong>Internet Gateway</strong>. The only customization to do here is to give it a name.</p>
<h3>Subnets</h3>
<p>You will need 2 subnets for this solution. &nbsp;The first is where your Lambda code will be run (you select the subnet to run in under the Lambda configuration, right after you select your VPC). The second subnet will be used as a gateway through which you can direct traffic to the internet. &nbsp;To create the two subnets, select the subnets field under&nbsp;<strong>Networking and Content Delivery</strong>&nbsp;&gt;&nbsp;<strong>VPC</strong>&nbsp;&gt;&nbsp;<strong>Subnets</strong>. Create two subnets, naming them whatever you want (For Example: LambdaSubnet and PublicAccessSubnet). When you create the subnet you will need to assign a CIDR Block for each. This should be a sub block of your VPC CIDR block. For example, if your VPC CIDR clock is 192.168.0.0/16 then for your Subnets you might pick 192.168.100.0/24 and 192.168.110.0/24. For now, no further customization of these subnets is needed.</p>
<h3>Elastic IP</h3>
<p>We are also going to need an Elastic IP. &nbsp;This will be the IP address that the world sees whenever your Lambda function talks to the internet. &nbsp;To create one go to&nbsp;<strong>Networking and Content Delivery</strong>&nbsp;&gt;&nbsp;<strong>VPC</strong>&nbsp;&gt;&nbsp;<strong>Elastic IPs</strong>&nbsp;and allocate new. &nbsp;Write down your new IP address for use later.</p>
<h3>NAT Gateway</h3>
<p>This is the thing they were talking about in their help text on the Lambda configuration page. &nbsp;We want to build a NAT Gateway inside our Public Subnet (Not the one where the Lambda code will run). To build one of these you go to&nbsp;<strong>Networking and Content Delivery</strong>&nbsp;&gt;&nbsp;<strong>VPC</strong>&nbsp;&gt;&nbsp;<strong>NAT Gateways</strong>&nbsp;and create new. Here you will need to select the Public Subnet and the Elastic IP that you created.</p>
<h3>Route Tables</h3>
<p>Now we only need to tell each subnet where to send its traffic, and we do this using Route Tables. &nbsp;The first Route Table we are going to build goes from our Lambda Subnet to the NAT gateway. &nbsp;To &nbsp;build this go to&nbsp;<strong>Networking and Content Delivery</strong>&nbsp;&gt;&nbsp;<strong>VPC</strong>&nbsp;&gt;&nbsp;<strong>Route Tables</strong>&nbsp;and create new, naming it whatever you want. &nbsp;Once the Table is created select it and switch to the Routes tab. &nbsp;Inside that tab edit the table and add a new route from destination 0.0.0.0/0 (Meaning all traffic) to target &lt;Your NAT gateway&gt;. &nbsp;Under the Subnet Associations tab click edit and select your Private subnet.</p>
<p>Great, now any traffic leaving your Lambda subnet will be routed to your NAT gateway (using your elastic IP) inside your Public subnet. &nbsp;Next we will use another route table to tell your public subnet to route the traffic to the Internet Gateway. &nbsp;Create a new Route Table and this time edit its routes to send destination 0.0.0.0/0 to your Internet Gateway. On this route associate the public subnet.</p>
<h3>Security Group</h3>
<p>The last step, when configuring your Lambda code, is to add it to a security group that allows outgoing connections. &nbsp;To create this security group go to&nbsp;<strong>Compute</strong>&nbsp;&gt;&nbsp;<strong>EC2</strong>&nbsp;&gt;&nbsp;<strong>Network &amp; Security</strong>&nbsp;&gt;&nbsp;<strong>Security Groups</strong>. &nbsp;Here, create a new security group and add the outbound rule All Traffic, All Protocols, All ports, Destination 0.0.0.0/0.</p>
<p>This will allow your Lambda code to send out requests (and receive their responses) but not to let inbound connections.</p>
<h3>Done</h3>
<p>With this all setup your Lambda function should be able to talk to other services inside your VPC while also sending requests out to the internet.</p>