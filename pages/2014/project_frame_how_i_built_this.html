<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Everyone meet Karthik</title>

    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <div class="wrapper">
        <header>
            <div style="width:100%; text-align: center;">
                <a href="/"><img src="/images/0.jpg" style="border-radius: 50%;" /></a>
            </div>
            <h1 style="margin-bottom: 1px; text-align: center;">//Karthik Srinivasan</h1>
            <p style="text-align: center;">
                Product Engineer, CTO & a Beer Enthusiast <br />
                Experiments, thoughts and scripts documented for posterity.
            </p>
            <p class="view" style="margin:0;"><a href="https://github.com/karthik20522?tab=repositories" target="_blank"><img src="/images/github.svg" height="15px" style="margin-right: 5px;" />Quirky Personal Projects</a></p>
            <p class="view" style="margin:0;"><a href="https://linkedin.com/in/karthik-srinivasan-07b23493/" target="_blank"><img src="data:image/png;base64,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" height="15px" style="margin-right: 5px;" />LinkedIn</a></p>
            <p class="view" style="margin:0;"><a href="/pages/beers_in_my_belly.html" target="_blank"><img src="/images/beer.png" height="15px" style="margin-right: 5px;" />Beers in my belly</a></p>
            <p class="view"><a href="mailto:karthik20522 (at) yahoo (dot) com" target="_blank"><img src="/images/email.png" height="15px" style="margin-right: 5px;" />Email me</a></p>
        </header>
        <section>
<h1>Project Frame - How I Built This</h1>
<p>Jun, 2014</p>
            The whole idea behind Project Frame was to provide the user the ability to download a part of the video, basically a online video clipper. <br><i>Note: I built this just for fun and its just a proof of concept.</i><br>
<br>
            Tools used:<br>
            - FFMPEG - <a href="http://www.ffmpeg.org/">http://www.ffmpeg.org</a><br>
            - ASP.NET 4.0<br>
            - GettyImages Connect API<br>
            - JQuery videoBG<br>
            - jQuery Wookmark plugin <br>
            - jQuery imagesLoaded plugin <br>
            - simplePagination.js<br>
            - Chardinjs<br>
            - jQuery pageSlide <br>
            - soundmanager 2 <br>
            - SLY <a href="https://github.com/Darsain/sly">https://github.com/Darsain/sly</a>
<br><br>
<b>Homepage:</b><br><br>
<a href="http://1.bp.blogspot.com/-5SZBoT4v7GI/UazmbfZbDfI/AAAAAAAAD0g/_JYLuoYOXo0/s1600/out_gif_kufli.gif" imageanchor="1"><img border="0" src="http://1.bp.blogspot.com/-5SZBoT4v7GI/UazmbfZbDfI/AAAAAAAAD0g/_JYLuoYOXo0/s640/out_gif_kufli.gif" /></a><br><br>
            The page is pretty simple page except for the background video. I used videoBG plugin to play video. So how did i build the video? FFMpeg has a way to superimpose multiple video in a grid layout. An example for generating grid layout can be found at <a href="https://ffmpeg.org/trac/ffmpeg/wiki/FilteringGuide#multipleinputoverlayin4x4grid">https://ffmpeg.org/trac/ffmpeg/wiki/FilteringGuide#multipleinputoverlayin4x4grid</a>. Using this as my starting point, I downloaded 16 videos from GettyImages.com and generated four 4x4 videos and took the final 4 videos and superimposed on top of each other to generate 1 large video with 16videos embedded within in. But off course the final video was gigantic, so I resized the final video to web size. <br><br>
<i>FFMpeg script code to generate the superimposed video:</i>
<code style="font-size:12px;">
    <pre>
ffmpeg -i 1.mov -i 2.mov -i 3.mov -i 4.mov -filter_complex "[0:0]pad=iw*2:ih*2[a],[a][1:0]overlay=w[b],[b][2:0]overlay=0:h[c],[c][3:0]overlay=w:h" -shortest output.mp4
</pre>
</code>
<i>FFMpeg script code to resize the video:</i>
<code style="font-size:12px;">
    <pre>
ffmpeg -i output.mp4 -s 720x480 -acodec copy output.mp4[webm]
</pre>
</code>


<br>
<b>Search Result Page:</b>
<br>
<table>
    <tr>
        <td>
            <a href="http://3.bp.blogspot.com/-IyHxv6NF_Fc/Uaz2JROy-3I/AAAAAAAAD0s/G7URYXYOHEA/s1600/hack-1.jpg" imageanchor="1"><img border="0" src="http://3.bp.blogspot.com/-IyHxv6NF_Fc/Uaz2JROy-3I/AAAAAAAAD0s/G7URYXYOHEA/s320/hack-1.jpg" /></a><br>
        </td>
        <td>
            Move along nothing fancy here. Connect API was used to search videos and jQuery Wookmark in combination with ImageLoader was used to display the result in pinterest style fashion.
        </td>
    <tr>
</table>
<br><br>
<b>Video Edit Page:</b>
<br><br>
<a href="http://3.bp.blogspot.com/-hZ0wgael5tc/UbTSiEfJkrI/AAAAAAAAD10/g3xEPmChru4/s1600/cuttingboard2.jpg" imageanchor="1"><img border="0" src="http://3.bp.blogspot.com/-hZ0wgael5tc/UbTSiEfJkrI/AAAAAAAAD10/g3xEPmChru4/s640/cuttingboard2.jpg" /></a>
<br><br>
            Few things happen here when the page is loaded:
<br>1) Download the video file to a temp. directory
<code style="font-size:12px;">
    <pre>
 var webClient = new WebClient();
 if (!string.IsNullOrEmpty(videoUrl))
  await webClient.DownloadFileTaskAsync(videoUrl, fileName);
 else
  throw new Exception("No video file found to download");
</pre>
</code>
<br>2) Generate thumbnails using ffmpeg
<code style="font-size:12px;">
    <pre>
 private Task<bool> GenerateThumbnails(string id, string videoFileLocation)
 {
  var tcs = new TaskCompletionSource<bool>();
  var ffmpegFile = ConfigurationManager.AppSettings["ffmpeg"];
  var thumbLocation = System.Web.HttpContext.Current.Server.MapPath("~/public/thumbs");
  var folderName = string.Format("{0}\\{1}", thumbLocation, id);

  if (!Directory.Exists(folderName))
   Directory.CreateDirectory(folderName);

  var arguments = string.Format("-i {0} -f image2 -vf fps=fps=1 -s 96x72 {1}\\out%d.jpg", videoFileLocation, folderName);

  var process = new Process
  {
   StartInfo = { FileName = ffmpegFile, Arguments = arguments },
   EnableRaisingEvents = true
  };
  process.Exited += (sender, args) => tcs.SetResult(true);
  process.Start();

  return tcs.Task;
 } 
</pre>
</code>

<table>
    <tr>
        <td>
            <a href="http://3.bp.blogspot.com/-Qq03bv0ZW90/Ua0HcGa1-OI/AAAAAAAAD1M/i7TBjF-9FbI/s1600/6-3-2013+5-14-43+PM.jpg" imageanchor="1"><img border="0" src="http://3.bp.blogspot.com/-Qq03bv0ZW90/Ua0HcGa1-OI/AAAAAAAAD1M/i7TBjF-9FbI/s320/6-3-2013+5-14-43+PM.jpg" /></a>
        </td>

        <td>
            This generates thumbnails of 96x72 dimensions and with files as out{number}.jpg. Folder structure something like the following:
        </td>
    <tr>
</table>

<br>
            3) There is Video metadata information view for which I used jQuery Imageslide.
<br><br>
<a href="http://1.bp.blogspot.com/-GDF_id_PYxI/Ua0IQrvrlUI/AAAAAAAAD1U/iZaNTYxVBcQ/s1600/6-3-2013+5-18-12+PM.jpg" imageanchor="1"><img border="0" src="http://1.bp.blogspot.com/-GDF_id_PYxI/Ua0IQrvrlUI/AAAAAAAAD1U/iZaNTYxVBcQ/s480/6-3-2013+5-18-12+PM.jpg" /></a>

<br><br>
            Following server side code snippet for generating the image information table which jquery pageslider uses for rendering.
<br><br>
<code style="font-size:12px;">
    <pre>
[HttpGet]
public HttpResponseMessage GetImageDetail(string id)
{
 _sb.AppendFormat(imageInfo.Urls.Thumb, imageInfo.Caption);
 _sb.AppendFormat(_pivotFormat, "Caption", imageInfo.Caption ?? string.Empty);
 _sb.AppendFormat(_pivotFormat, "Date Created", imageInfo.DateCreated.ToString("F"));
 _sb.AppendFormat(_pivotFormat, "Artist", imageInfo.FilmMaker ?? string.Empty);
 _sb.AppendFormat(_pivotFormat, "Asset Family", imageInfo.AssetFamily ?? string.Empty);
 _sb.AppendFormat(_pivotFormat, "Era", imageInfo.Era ?? string.Empty);
 _sb.AppendFormat(_pivotFormat, "Keywords", string.Join(", ", imageInfo.Keywords.Select(s => s.Text).ToList()));
 _sb.AppendFormat(_pivotFormat, "Clip Length", imageInfo.ClipLength ?? string.Empty);
 _sb.AppendFormat(_pivotFormat, "Copyright", imageInfo.Copyright ?? string.Empty);
 _sb.AppendFormat(_pivotFormat, "Collection Name", imageInfo.CollectionName ?? string.Empty);
 _sb.AppendFormat(_pivotFormat, "Color Type", imageInfo.Color ?? string.Empty);
 _sb.AppendFormat(_pivotFormat, "Mastered To", imageInfo.MasteredTo ?? string.Empty);
 _sb.AppendFormat(_pivotFormat, "Camera Type", imageInfo.OriginallyShotOn ?? string.Empty);
</pre>
</code>

<br>
            4) Once the user selects the preferred video range, following code is executed on the server side to clip the video using ffmpeg.<br>
<br><a href="http://4.bp.blogspot.com/-EzydTbeX6oY/Ua0JjfvH6HI/AAAAAAAAD1k/bP2m-9vSano/s1600/6-3-2013+5-23-44+PM.jpg" imageanchor="1"><img border="0" src="http://4.bp.blogspot.com/-EzydTbeX6oY/Ua0JjfvH6HI/AAAAAAAAD1k/bP2m-9vSano/s640/6-3-2013+5-23-44+PM.jpg" /></a>
<br>
<code style="font-size:12px;">
    <pre>
 private Task<bool> ClipVideo(string fileName, string outputName, int startSecond, int duration)
 {
  var tcs = new TaskCompletionSource<bool>();
  var ffmpegFile = ConfigurationManager.AppSettings["ffmpeg"];
  var clipLocation = System.Web.HttpContext.Current.Server.MapPath("~/public/clip");
  var videoLocation = System.Web.HttpContext.Current.Server.MapPath("~/public/downloads");

  var arguments = string.Format("-sameq -ss {0} -t {1} -i {2} {3}", startSecond, duration, string.Format("{0}\\{1}", videoLocation, fileName), 
   string.Format("{0}\\{1}", clipLocation, outputName));

  var process = new Process
  {
   StartInfo = { FileName = ffmpegFile, Arguments = arguments },
   EnableRaisingEvents = true
  };
  process.Exited += (sender, args) => tcs.SetResult(true);
  process.Start();

  return tcs.Task;
 }
</pre>
</code>
<br>

            Off-course this solution of downloading the video file and generating the thumbnail is not a viable solution for a real world scenario. But we could always pre-process the thumbnails and
            store the thumbnails are an image sprite (saving as an image sprite would save number of files the OS would have to handle; off-course this sprite technique was ment for real world scenario).
            Since the entire code based (server side) is all async/TPL based, multiple users using the tool works quite well. But there is always an alternate solution for video processing like Animoto or
            Amazon Transcoding service.
<!--*********************FOOTER'ISH************************-->
<div id="graphcomment"></div>
<script type="text/javascript">
    /*window.gc_params = {
        graphcomment_id: 'Karthik-Github',
        fixed_header_height: 0,
    };
    (function () {
        var gc = document.createElement('script'); gc.type = 'text/javascript'; gc.async = true;
        gc.src = 'https://graphcomment.com/js/integration.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(gc);
    })();*/
</script>

</section>
<footer></footer>
</div>
<script src="/javascripts/scale.fix.js"></script>
<script>
/*    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-140795658-1');*/
</script>
</body>
</html>
